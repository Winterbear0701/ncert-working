{% extends 'base_new.html' %}

{% block title %}Quiz Analytics - {{ chapter.chapter_name }}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">
            {{ chapter.subject }} - {{ chapter.chapter_name }}
        </h1>
        <p class="text-gray-600">Detailed performance analytics and progress tracking</p>
    </div>

    <!-- No attempts -->
    {% if not attempts %}
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-12 text-center">
        <svg class="w-20 h-20 mx-auto text-blue-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
        </svg>
        <h3 class="text-2xl font-semibold text-gray-900 mb-2">No Data Available</h3>
        <p class="text-gray-600 mb-6">Take this quiz to see detailed analytics!</p>
        <a href="{% url 'students:start_quiz' chapter.chapter_id %}" 
           class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Start Quiz
        </a>
    </div>
    {% else %}

    <!-- Modern Summary Stats with Gradient Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Total Attempts Card -->
        <div class="relative overflow-hidden bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 rounded-2xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all duration-300">
            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full"></div>
            <div class="absolute bottom-0 left-0 -mb-4 -ml-4 w-32 h-32 bg-white opacity-5 rounded-full"></div>
            <div class="relative">
                <div class="flex items-center justify-between mb-3">
                    <div class="p-3 bg-white/20 backdrop-blur-sm rounded-xl">
                        <i class="fas fa-redo-alt text-2xl"></i>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-blue-100 font-medium">Total Attempts</p>
                    </div>
                </div>
                <div class="text-5xl font-black mb-1">{{ attempts|length }}</div>
                <div class="flex items-center text-sm text-blue-100">
                    <i class="fas fa-chart-line mr-2"></i>
                    <span>Quiz taken {{ attempts|length }} time{{ attempts|length|pluralize }}</span>
                </div>
            </div>
        </div>

        <!-- Best Score Card -->
        <div class="relative overflow-hidden bg-gradient-to-br from-emerald-500 via-green-600 to-teal-700 rounded-2xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all duration-300">
            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full"></div>
            <div class="absolute bottom-0 left-0 -mb-4 -ml-4 w-32 h-32 bg-white opacity-5 rounded-full"></div>
            <div class="relative">
                <div class="flex items-center justify-between mb-3">
                    <div class="p-3 bg-white/20 backdrop-blur-sm rounded-xl">
                        <i class="fas fa-trophy text-2xl"></i>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-green-100 font-medium">Best Score</p>
                    </div>
                </div>
                <div class="text-5xl font-black mb-1">{{ best_score|floatformat:0 }}%</div>
                <div class="flex items-center text-sm text-green-100">
                    <i class="fas fa-star mr-2"></i>
                    <span>{% if best_score >= 90 %}Outstanding!{% elif best_score >= 80 %}Excellent!{% elif best_score >= 70 %}Great Job!{% else %}Keep Going!{% endif %}</span>
                </div>
            </div>
        </div>

        <!-- Average Score Card -->
        <div class="relative overflow-hidden bg-gradient-to-br from-purple-500 via-indigo-600 to-blue-700 rounded-2xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all duration-300">
            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full"></div>
            <div class="absolute bottom-0 left-0 -mb-4 -ml-4 w-32 h-32 bg-white opacity-5 rounded-full"></div>
            <div class="relative">
                <div class="flex items-center justify-between mb-3">
                    <div class="p-3 bg-white/20 backdrop-blur-sm rounded-xl">
                        <i class="fas fa-chart-bar text-2xl"></i>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-purple-100 font-medium">Average Score</p>
                    </div>
                </div>
                <div class="text-5xl font-black mb-1">{{ average_score|floatformat:0 }}%</div>
                <div class="flex items-center text-sm text-purple-100">
                    <i class="fas fa-balance-scale mr-2"></i>
                    <span>Overall performance</span>
                </div>
            </div>
        </div>

        <!-- Improvement Card -->
        <div class="relative overflow-hidden bg-gradient-to-br {% if improvement >= 0 %}from-orange-500 via-amber-600 to-yellow-600{% else %}from-red-500 via-rose-600 to-pink-600{% endif %} rounded-2xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all duration-300">
            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full"></div>
            <div class="absolute bottom-0 left-0 -mb-4 -ml-4 w-32 h-32 bg-white opacity-5 rounded-full"></div>
            <div class="relative">
                <div class="flex items-center justify-between mb-3">
                    <div class="p-3 bg-white/20 backdrop-blur-sm rounded-xl">
                        <i class="fas fa-{% if improvement >= 0 %}arrow-trend-up{% else %}arrow-trend-down{% endif %} text-2xl"></i>
                    </div>
                    <div class="text-right">
                        <p class="text-sm {% if improvement >= 0 %}text-orange-100{% else %}text-red-100{% endif %} font-medium">Improvement</p>
                    </div>
                </div>
                <div class="text-5xl font-black mb-1">
                    {% if improvement >= 0 %}+{% endif %}{{ improvement|floatformat:0 }}%
                </div>
                <div class="flex items-center text-sm {% if improvement >= 0 %}text-orange-100{% else %}text-red-100{% endif %}">
                    <i class="fas fa-{% if improvement >= 0 %}fire{% else %}exclamation-triangle{% endif %} mr-2"></i>
                    <span>{% if improvement >= 0 %}Growing stronger!{% else %}Need more practice{% endif %}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Heatmap - The WOW Section! -->
    <div class="bg-gradient-to-br from-slate-50 via-white to-blue-50 rounded-2xl shadow-2xl p-8 mb-8 border border-slate-200">
        <div class="flex items-center justify-between mb-8">
            <div>
                <h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 mb-2 flex items-center">
                    <i class="fas fa-fire text-orange-500 mr-3 animate-pulse"></i>
                    Performance Heatmap
                </h2>
                <p class="text-slate-600 text-sm">Visual journey of your quiz attempts - darker colors mean better scores!</p>
            </div>
            <div class="hidden lg:block">
                <div class="bg-white rounded-xl p-4 shadow-lg border border-slate-200">
                    <div class="flex items-center space-x-3 text-xs font-semibold text-slate-600">
                        <span>Score:</span>
                        <div class="flex items-center space-x-1">
                            <div class="w-6 h-6 rounded bg-gradient-to-br from-red-200 to-red-300"></div>
                            <span>Low</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <div class="w-6 h-6 rounded bg-gradient-to-br from-yellow-300 to-amber-400"></div>
                            <span>Medium</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <div class="w-6 h-6 rounded bg-gradient-to-br from-green-500 to-emerald-600"></div>
                            <span>High</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Heatmap Grid -->
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
            {% for attempt in attempts %}
            <div class="group relative transform hover:scale-105 transition-all duration-300">
                <!-- Heatmap Cell -->
                <div class="relative overflow-hidden rounded-2xl shadow-xl
                    {% if attempt.score_percentage >= 90 %}bg-gradient-to-br from-emerald-500 via-green-600 to-teal-700
                    {% elif attempt.score_percentage >= 80 %}bg-gradient-to-br from-green-400 via-emerald-500 to-green-600
                    {% elif attempt.score_percentage >= 70 %}bg-gradient-to-br from-yellow-400 via-amber-500 to-orange-500
                    {% elif attempt.score_percentage >= 60 %}bg-gradient-to-br from-orange-400 via-amber-500 to-yellow-500
                    {% elif attempt.score_percentage >= 50 %}bg-gradient-to-br from-red-400 via-rose-500 to-pink-500
                    {% else %}bg-gradient-to-br from-red-500 via-red-600 to-rose-700{% endif %}
                    p-6 text-white h-40 flex flex-col justify-between">
                    
                    <!-- Decorative Elements -->
                    <div class="absolute top-0 right-0 -mt-4 -mr-4 w-20 h-20 bg-white opacity-10 rounded-full"></div>
                    <div class="absolute bottom-0 left-0 -mb-4 -ml-4 w-16 h-16 bg-black opacity-10 rounded-full"></div>
                    
                    <!-- Content -->
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-bold opacity-90">Attempt {{ forloop.counter }}</span>
                            {% if attempt.score_percentage >= 90 %}
                                <i class="fas fa-crown text-yellow-300 animate-bounce"></i>
                            {% elif attempt.score_percentage >= 80 %}
                                <i class="fas fa-star"></i>
                            {% elif attempt.score_percentage >= 70 %}
                                <i class="fas fa-smile"></i>
                            {% elif attempt.score_percentage >= 60 %}
                                <i class="fas fa-meh"></i>
                            {% else %}
                                <i class="fas fa-frown"></i>
                            {% endif %}
                        </div>
                        
                        <!-- Score -->
                        <div class="text-5xl font-black mb-1">
                            {{ attempt.score_percentage|floatformat:0 }}<span class="text-2xl">%</span>
                        </div>
                        
                        <!-- Status Badge -->
                        <div class="inline-flex items-center space-x-1 px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full text-xs font-bold">
                            {% if attempt.score_percentage >= 90 %}
                                <i class="fas fa-fire-alt"></i><span>Outstanding!</span>
                            {% elif attempt.score_percentage >= 80 %}
                                <i class="fas fa-check-circle"></i><span>Excellent!</span>
                            {% elif attempt.score_percentage >= 70 %}
                                <i class="fas fa-thumbs-up"></i><span>Good Job!</span>
                            {% elif attempt.score_percentage >= 60 %}
                                <i class="fas fa-hand-paper"></i><span>Keep Going</span>
                            {% else %}
                                <i class="fas fa-redo"></i><span>Try Again</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Date -->
                    <div class="relative z-10 text-xs opacity-75 flex items-center">
                        <i class="fas fa-calendar-alt mr-2"></i>
                        {{ attempt.submitted_at|date:"M d, Y" }}
                    </div>
                </div>

                <!-- Hover Tooltip -->
                <div class="absolute -bottom-20 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-20">
                    <div class="bg-slate-900 text-white px-4 py-3 rounded-xl shadow-2xl text-sm whitespace-nowrap">
                        <div class="font-bold mb-1">Details</div>
                        <div class="text-xs space-y-1 text-slate-300">
                            <div><i class="fas fa-check-circle mr-2 text-green-400"></i>Score: {{ attempt.score_percentage|floatformat:1 }}%</div>
                            <div><i class="fas fa-clock mr-2 text-blue-400"></i>{{ attempt.submitted_at|date:"M d, h:i A" }}</div>
                            <div><i class="fas fa-question-circle mr-2 text-purple-400"></i>{{ attempt.total_questions }} questions</div>
                        </div>
                        <!-- Arrow -->
                        <div class="absolute -top-2 left-1/2 transform -translate-x-1/2 w-4 h-4 bg-slate-900 rotate-45"></div>
                    </div>
                </div>
            </div>
            {% endfor %}

            <!-- Add New Attempt Card -->
            <a href="{% url 'students:start_quiz' chapter.chapter_id %}" 
               class="group relative transform hover:scale-105 transition-all duration-300">
                <div class="relative overflow-hidden rounded-2xl border-4 border-dashed border-slate-300 hover:border-blue-500 bg-gradient-to-br from-slate-50 to-blue-50 p-6 h-40 flex flex-col items-center justify-center text-center transition-all duration-300 hover:shadow-2xl">
                    <div class="absolute inset-0 bg-gradient-to-br from-blue-500 to-indigo-600 opacity-0 group-hover:opacity-10 transition-opacity"></div>
                    <div class="relative z-10">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mb-3 transform group-hover:rotate-180 transition-transform duration-500 shadow-lg">
                            <i class="fas fa-plus text-3xl text-white"></i>
                        </div>
                        <p class="text-sm font-bold text-slate-700 group-hover:text-blue-600 transition-colors">Take New Quiz</p>
                        <p class="text-xs text-slate-500 mt-1">Challenge yourself!</p>
                    </div>
                </div>
            </a>
        </div>

        <!-- Performance Stats Bar -->
        <div class="mt-8 bg-white rounded-xl p-6 shadow-lg border border-slate-200">
            <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                <i class="fas fa-chart-line text-blue-600 mr-2"></i>
                Quick Stats
            </h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center">
                    <div class="text-3xl font-black text-emerald-600">
                        {{ attempts|length|add:0|floatformat:0 }}
                    </div>
                    <div class="text-xs text-slate-600 mt-1">Total Attempts</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-black text-blue-600">
                        {{ average_score|floatformat:0 }}%
                    </div>
                    <div class="text-xs text-slate-600 mt-1">Average Score</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-black text-purple-600">
                        {{ best_score|floatformat:0 }}%
                    </div>
                    <div class="text-xs text-slate-600 mt-1">Best Score</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-black {% if improvement >= 0 %}text-orange-600{% else %}text-red-600{% endif %}">
                        {% if improvement >= 0 %}+{% endif %}{{ improvement|floatformat:0 }}%
                    </div>
                    <div class="text-xs text-slate-600 mt-1">Growth Rate</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Attempts List -->
    <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 border border-slate-200">
        <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center">
            <i class="fas fa-list-ol text-indigo-600 mr-3"></i>
            All Attempts Timeline
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for attempt in attempts %}
            <div class="group relative overflow-hidden rounded-xl shadow-md hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1
                {% if attempt.score_percentage >= 80 %}bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-300
                {% elif attempt.score_percentage >= 60 %}bg-gradient-to-br from-yellow-50 to-amber-50 border-2 border-yellow-300
                {% else %}bg-gradient-to-br from-red-50 to-rose-50 border-2 border-red-300{% endif %} p-5">
                
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center space-x-2">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-white
                            {% if attempt.score_percentage >= 80 %}bg-gradient-to-br from-green-500 to-emerald-600
                            {% elif attempt.score_percentage >= 60 %}bg-gradient-to-br from-yellow-500 to-amber-600
                            {% else %}bg-gradient-to-br from-red-500 to-rose-600{% endif %}">
                            {{ forloop.counter }}
                        </div>
                        <div>
                            <p class="text-sm font-bold text-slate-800">Attempt {{ forloop.counter }}</p>
                            <p class="text-xs text-slate-500">{{ attempt.submitted_at|date:"M d, Y" }}</p>
                        </div>
                    </div>
                    {% if attempt.score_percentage >= 90 %}
                        <i class="fas fa-crown text-yellow-500 text-xl animate-pulse"></i>
                    {% elif attempt.score_percentage >= 80 %}
                        <i class="fas fa-star text-green-500 text-xl"></i>
                    {% elif attempt.score_percentage >= 70 %}
                        <i class="fas fa-thumbs-up text-blue-500 text-lg"></i>
                    {% endif %}
                </div>

                <div class="mb-3">
                    <div class="text-4xl font-black
                        {% if attempt.score_percentage >= 80 %}text-green-700
                        {% elif attempt.score_percentage >= 60 %}text-yellow-700
                        {% else %}text-red-700{% endif %}">
                        {{ attempt.score_percentage|floatformat:0 }}<span class="text-xl">%</span>
                    </div>
                </div>

                <div class="flex items-center justify-between text-xs">
                    <span class="inline-flex items-center space-x-1 px-3 py-1 rounded-full font-semibold
                        {% if attempt.score_percentage >= 80 %}bg-green-200 text-green-800
                        {% elif attempt.score_percentage >= 60 %}bg-yellow-200 text-yellow-800
                        {% else %}bg-red-200 text-red-800{% endif %}">
                        {% if attempt.is_passed %}
                            <i class="fas fa-check-circle"></i><span>Passed</span>
                        {% else %}
                            <i class="fas fa-times-circle"></i><span>Failed</span>
                        {% endif %}
                    </span>
                    <span class="text-slate-600">
                        <i class="fas fa-clock mr-1"></i>
                        {{ attempt.submitted_at|date:"h:i A" }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Topic Performance Comparison -->
    {% if topic_averages %}
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
            <svg class="w-7 h-7 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
            </svg>
            Topic Performance Summary
        </h2>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Topic</th>
                        {% for attempt in attempts %}
                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Attempt {{ forloop.counter }}
                        </th>
                        {% endfor %}
                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Average</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for topic_data in topic_averages.items %}
                    {% with topic=topic_data.0 avg=topic_data.1 %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900">{{ topic }}</td>
                        {% for attempt in attempts %}
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <span class="text-gray-400 text-sm">-</span>
                        </td>
                        {% endfor %}
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <span class="inline-flex items-center px-4 py-2 rounded-xl text-sm font-bold shadow-lg
                                {% if avg >= 80 %}bg-gradient-to-r from-green-400 to-emerald-500 text-white
                                {% elif avg >= 60 %}bg-gradient-to-r from-yellow-400 to-amber-500 text-white
                                {% else %}bg-gradient-to-r from-red-400 to-rose-500 text-white{% endif %}">
                                <i class="fas fa-{% if avg >= 80 %}star{% elif avg >= 60 %}smile{% else %}meh{% endif %} mr-2"></i>
                                {{ avg|floatformat:0 }}%
                            </span>
                        </td>
                    </tr>
                    {% endwith %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Insights & Recommendations -->
    <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg shadow-md p-6 mb-8 border border-purple-200">
        <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
            <svg class="w-7 h-7 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
            Insights & Recommendations
        </h2>

        <div class="space-y-3">
            {% if best_score >= chapter.passing_percentage %}
            <div class="flex items-start bg-green-100 rounded-lg p-4">
                <svg class="w-6 h-6 text-green-600 mr-3 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p class="text-green-900"><strong>Congratulations!</strong> You've passed this chapter with {{ best_score|floatformat:0 }}%. The next chapter is now unlocked!</p>
            </div>
            {% else %}
            <div class="flex items-start bg-yellow-100 rounded-lg p-4">
                <svg class="w-6 h-6 text-yellow-600 mr-3 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                <p class="text-yellow-900"><strong>Keep going!</strong> You need {{ chapter.passing_percentage }}% to pass. You're at {{ best_score|floatformat:0 }}% - only {{ chapter.passing_percentage|floatformat:0|add:"-"|add:best_score|floatformat:0 }}% away!</p>
            </div>
            {% endif %}

            {% if improvement > 10 %}
            <div class="flex items-start bg-blue-100 rounded-lg p-4">
                <svg class="w-6 h-6 text-blue-600 mr-3 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
                <p class="text-blue-900"><strong>Great improvement!</strong> Your score increased by {{ improvement|floatformat:0 }}% from first to last attempt. Keep up the excellent work!</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-4 justify-center flex-wrap">
        <a href="{% url 'students:start_quiz' chapter.chapter_id %}" 
           class="px-8 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium inline-flex items-center text-lg">
            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Take Quiz Again
        </a>

        <a href="{% url 'students:quiz_history' %}" 
           class="px-8 py-4 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium inline-flex items-center text-lg">
            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            View All History
        </a>

        <a href="{% url 'students:quiz_dashboard' %}" 
           class="px-8 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium inline-flex items-center text-lg">
            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            Quiz Dashboard
        </a>
    </div>

    {% endif %}
</div>
{% endblock %}
